<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Live SVG Trading Chart</title>

<style>
body{
  background:#0b1220;
  font-family:system-ui,Segoe UI,Roboto;
  color:#fff;
}

select{
  background:#111a2e;
  color:#fff;
  padding:8px 12px;
  border-radius:6px;
  border:none;
  margin:14px;
}

.chart-wrapper{
  width:420px;
  height:260px;
  background:#0e1626;
  border-radius:10px;
  padding:10px;
}

svg{width:100%;height:100%}

.grid line{stroke:rgba(255,255,255,.08)}
#yLabels text{fill:#9aa4c7;font-size:11px}
</style>
</head>

<body>

<select id="market">
  <option value="BTCUSD">BTCUSD</option>
  <option value="ETHUSD">ETHUSD</option>
  <option value="EURUSD">EURUSD</option>
  <option value="USDJPY">USDJPY</option>
  <option value="GBPUSD">GBPUSD</option>
  <option value="AUDUSD">AUDUSD</option>
</select>

<div class="chart-wrapper">
<svg id="chart" viewBox="0 0 420 260" preserveAspectRatio="none">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="rgba(31,209,138,.25)"/>
      <stop offset="100%" stop-color="rgba(31,209,138,0)"/>
    </linearGradient>
  </defs>

  <g class="grid"></g>
  <path id="area" fill="url(#g)"></path>
  <path id="line" fill="none" stroke="#1fd18b" stroke-width="2"/>
  <line id="lastLine" stroke="#fff" stroke-width="1"/>
  <rect id="box" rx="4" fill="#fff"/>
  <text id="price" fill="#000" font-size="11"
        text-anchor="middle" dominant-baseline="middle"></text>
  <g id="yLabels"></g>
</svg>
</div>

<script>
const API_KEY = "6Z08ZDGBCFE2C8MK";

const svg = document.getElementById("chart");
const grid = svg.querySelector(".grid");
const yLabels = document.getElementById("yLabels");
const line = document.getElementById("line");
const area = document.getElementById("area");
const lastLine = document.getElementById("lastLine");
const box = document.getElementById("box");
const priceText = document.getElementById("price");

const W=420,H=260,p={t:20,r:60,b:20,l:10};

/* ================= DRAW ================= */
function draw(data){
  if(!data || data.length<2) return;

  grid.innerHTML=""; yLabels.innerHTML="";
  const min=Math.min(...data), max=Math.max(...data);
  const step=(W-p.l-p.r)/(data.length-1);
  const y=v=>p.t+(H-p.t-p.b)*(1-(v-min)/(max-min||1));

  for(let i=0;i<10;i++){
    const yy=p.t+i*(H-p.t-p.b)/9;
    grid.innerHTML+=`<line x1="${p.l}" y1="${yy}" x2="${W-p.r}" y2="${yy}"/>`;
    yLabels.innerHTML+=`<text x="${W-6}" y="${yy}" text-anchor="end">
      ${(min+(max-min)*(9-i)/9).toFixed(2)}
    </text>`;
  }

  let d="";
  data.forEach((v,i)=>{
    const x=p.l+i*step, yy=y(v);
    d+=i?`L ${x} ${yy}`:`M ${x} ${yy}`;
  });

  line.setAttribute("d",d);
  area.setAttribute("d",
    `${d} L ${p.l+(data.length-1)*step} ${H-p.b} L ${p.l} ${H-p.b} Z`
  );

  const last=data.at(-1), ly=y(last);
  lastLine.setAttribute("x1",p.l);
  lastLine.setAttribute("x2",W-p.r);
  lastLine.setAttribute("y1",ly);
  lastLine.setAttribute("y2",ly);

  box.setAttribute("x",W-p.r+6);
  box.setAttribute("y",ly-10);
  box.setAttribute("width",52);
  box.setAttribute("height",20);

  priceText.setAttribute("x",W-p.r+32);
  priceText.setAttribute("y",ly);
  priceText.textContent=last.toFixed(2);
}

/* ================= LOADERS ================= */
async function crypto(sym){
  const r=await fetch(
    `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${sym}&market=USD&apikey=${API_KEY}`
  );
  const j=await r.json();
  const t=j["Time Series (Digital Currency Daily)"];
  return Object.values(t).slice(0,60).reverse().map(v=>+v["4a. close (USD)"]);
}

async function forex(pair){
  const r=await fetch(
    `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=${pair.slice(0,3)}&to_symbol=${pair.slice(3)}&apikey=${API_KEY}`
  );
  const j=await r.json();
  const t=j["Time Series FX (Daily)"];
  return Object.values(t).slice(0,60).reverse().map(v=>+v["4. close"]);
}

async function load(symbol){
  let data;
  if(symbol.endsWith("USD") && symbol.length===6 && symbol!=="EURUSD" && symbol!=="GBPUSD"){
    data=await crypto(symbol.replace("USD",""));
  }else{
    data=await forex(symbol);
  }
  draw(data);
}

document.getElementById("market").onchange=e=>load(e.target.value);
load("BTCUSD");
</script>

</body>
</html>
